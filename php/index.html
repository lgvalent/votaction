<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	 <meta name="viewport" content="width=device-width, initial-scale=1">
	 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
	 <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">	
	<title>VotAction</title>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

<body ng-app="votaction">

<div ng-cloak ng-controller="adminCtrl" class="container">
	<div class="page-header">
		<h1>Sistema de votação online<a href="#" onclick="location.reload(true)">&reg;</a></h1>
		<p class=" text-right"><span class="badge badge-secondary">Seção atual={{sessionId}}</span></p>
	</div>
	<div ng-show="status=='menu'" class="w3-container">
		<button ng-click="newSession()" class="btn btn-success btn-block">Iniciar uma comissão</button>
		<button ng-click="joinSession()" class="btn btn-warning btn-block">Participar de uma comissão</button>
		<button ng-click="startResults()" class="btn btn-primary btn-block">Resultados</button>
	</div>
	<div ng-show="status=='newRole'" class="card">
		<div class="card-header">Iniciando votação de um novo cargo</div>
		<div class="card-body">
			<form>
				<div class="form-group">
	 			<label class="control-label">Nome do cargo</label>
		 		<input required class="form-control" type="text" required ng-model="roleName" ng-disabled="false" placeholder="Ancião, Diretor, Chefe, ...">
				</div>

				<div class="form-group">
	 			<label class="control-label">Quantas escolhas podem ser marcadas?</label>
	 			<input required type="number" class="form-control form-control-sm" ng-model="roleMaxOptions" value="" min="1" max="100">
				</div>

				<div class="form-group">
	 			<label class="control-label">Nomes indicados</label>
	 			<textarea  required rows="10" class="form-control form-control-sm" ng-model="roleOptionsTxt"  placeholder="Insira os nomes separados por ENTER e sem linhas em branco"></textarea>
				</div>

				<button class="btn btn-success btn-block" ng-click="confirmNewRole()" ng-disabled="error || incomplete">&#10004; Iniciar votação</button>
			</form>
		</div>
	</div>
	<div ng-show="status=='vote'" class="card">
		<div class="card-header">Vote agora</div>
		<div class="card-body">
			<p class="card-title">Nome do cargo: <span class="badge badge-secondary">{{roleName}}</span></p>
			<p class="card-text">Você já escolheu <span class="badge badge-secondary" ng-style="roleVote.length == roleMaxOptions && {'background-color':'green'}  || roleVote.length != roleMaxOptions && {'background-color':'red'}" >{{roleVote.length}}</span> opção(ões) de <span class="badge badge-secondary">{{roleMaxOptions}}</span>.</p>
			<form>
				<div ng-repeat="option in roleOptions">
					<div class="form-check">
						<label class="form-check-label text-success">
		 				<input class="form-check-input" type="checkbox" value="{{option.name}}" ng-model="option.selected" ng-change="updateRoleVote()">
		 				{{option.name}}
			  			</label>
					 </div>
				</div>
				<button class="btn btn-warning btn-block" ng-click="confirmVote()" ng-disabled="status!='vote'">&#10004; Confirmar</button>
			</form>
		</div>
	</div>
	<div ng-show="status=='results'" class="card">
		<div class="card-header">Apuração atual</div>
		<div class="card-body">
			<p class="card-title">Nome do cargo: <span class="badge badge-secondary">{{roleName}}</span></p>
			<p class="card-text">Até <span class="badge badge-secondary">{{roleMaxOptions}}</span> voto(s) por pessoa.</p>
			<label>Total de votos:</label> <span class="badge badge-secondary">{{roleVotesCount}}</span> | Aprox. <span class="badge badge-secondary">{{roleVotesCount/roleMaxOptions | number: 0}}</span> pessoas já votaram.<br>

			<ol class="container">
				<li ng-repeat="x in roleVotes | orderBy: 'total': true" class="d-flex justify-content-between">
					{{$index+1}}º - {{x.roleName}} <span><span ng-if="$index<roleMaxOptions" >(Eleito)</span><span class="badge badge-secondary badge-pill px-4 py-1 mt-2">{{x.total}}</span></span>
				</li>
			</ol>
		</div>
		<button class="btn btn-primary btn-block" ng-click="startNewRole()" ng-show="sessionAdmin">&#10004; Novo cargo</button>
	</div>
	<br/>
	<div id="status" class="progress fixed-bottom">
		<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">
			<label class=""><i>{{message}}</i></label>
		</div>
	 </div>
</div>
<p class=" text-right"> <small>Desenvolvido por <a href="mailto:lucio valentin.com.br">Lucio Valentin<a/>: <i>versão 0.6b</i></small></p>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<script src="index.js"></script>
</body>
</html>
